<p>
    For years, OpenShift <a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.14/html-single/builds_using_buildconfig/index">BuildConfig</a> has been the standard way to build container images directly on <a href="https://developers.redhat.com/products/openshift/overview">Red Hat OpenShift</a> clusters. Now, new build tools are available as the cloud-native ecosystem changes.
</p>
<p>
    <a href="https://github.com/redhat-openshift-builds/">Builds for Red Hat OpenShift</a> is Red Hat's extensible framework for building container images on OpenShift. It is based on the open source project <a href="https://github.com/shipwright-io/">Shipwright</a>, which provides a vendor-neutral framework for building container images on Kubernetes.
</p>
<p>
    Built on top of OpenShift Pipelines (Tekton), Builds for Red Hat OpenShift offers a flexible way to build containers with enterprise support from Red Hat.
</p>
<p>
    Today, we are announcing a developer preview for migrating from OpenShift BuildConfig resources to Builds for Red Hat OpenShift using <a href="https://github.com/migtools/crane">Crane</a>. This new upstream capability in Crane enables you to automatically convert your existing OpenShift BuildConfig resources to Builds for Red Hat OpenShift resources.
</p>
<h2>
    What is Crane?
</h2>
<p>
    <a href="https://github.com/migtools/crane">Crane</a> is an open source migration tool from the <a href="https://www.konveyor.io/">Konveyor</a> community. It helps application owners migrate Kubernetes workloads and their state between clusters using an Extract, Transform, and Apply framework.
</p>
<p>
    This new BuildConfig conversion capability adds to the Crane migration toolkit to help organizations modernize their container build infrastructure.
</p>
<rh-alert state="caution">
<h3 slot="header">
    Developer preview notice
</h3>
<span class="rhalert-content">
<p>
    This BuildConfig migration feature is available as an upstream community capability in Crane. It is not yet included in official Red Hat product offerings. As a developer preview, it is intended for evaluation and feedback purposes and is not supported for production use.
</p>
</span></rh-alert>
<h2>
    What gets migrated?
</h2>
<p>
    Crane automatically converts your BuildConfig resources to Builds for Red Hat OpenShift. Here's what's supported.
</p>
<h3>
    Build strategies
</h3>
<p>
    Crane converts Docker strategy BuildConfig resources to the Buildah <code>ClusterBuildStrategy</code>. It also converts Source strategy BuildConfig resources to use Source-to-Image <code>ClusterBuildStrategy</code>.
</p>
<h3>
    Source types
</h3>
<p>
    The tool handles all major source types:
</p>
<ul>
    <li>
        <strong>Git sources</strong>: Full support for repository URL, branch and tag references, and clone secrets.
    </li>
    <li>
        <strong>Binary sources</strong>: Converted to <code>Local</code> source type with streaming support.
    </li>
    <li>
        <strong>Image sources</strong>: Converted to OCI artifact sources for image-based builds.
    </li>
</ul>
<h3>
    Key features migrated
</h3>
<p>
    Crane migrates these configuration settings from your BuildConfig to the new Builds for Red Hat OpenShift format:
</p>
<ul>
    <li>
        <strong>Environment variables:</strong> These transfer automatically to the <code>Build</code> specification.
    </li>
    <li>
        <strong>Build arguments:</strong> Docker build arguments are converted to <code>ParamValues</code>.
    </li>
    <li>
        <strong>Dockerfile paths:</strong> Custom Dockerfile locations are preserved.
    </li>
    <li>
        <strong>Git proxy configuration:</strong> HTTP/HTTPS proxy settings are converted to environment variables.
    </li>
    <li>
        <strong>Source secrets:</strong> Clone secrets for private Git repositories.
    </li>
    <li>
        <strong>Push secrets:</strong> Registry authentication for pushing images.
    </li>
    <li>
        <strong>Context directories:</strong> Build context paths are maintained.
    </li>
</ul>
<h2>
    How it works
</h2>
<p>
    The migration process follows the following workflow:
</p>
<ol>
    <li>
        <strong>Discovery</strong>: Crane connects to your cluster and lists all BuildConfig resources in the specified namespace.
    </li>
    <li>
        <strong>Analysis</strong>: Each BuildConfig is analyzed for its strategy type, source configuration, and output settings.
    </li>
    <li>
        <strong>Validation</strong>: Pull secrets are validated to ensure they contain the required credentials.
    </li>
    <li>
        <strong>Conversion</strong>: Resources are mapped to their Builds for Red Hat OpenShift equivalents.
    </li>
</ol>
<h2>
    Getting started: Migrating a BuildConfig with Docker strategy and Git source
</h2>
<p>
    Ready to try the developer preview? This sections explains how to get started, walking through a complete migration example step by step.
</p>
<h3>
    Prerequisites
</h3>
<p>
    You will need the following installed on your cluster:
</p>
<ul>
    <li>
        Red Hat OpenShift Pipelines
    </li>
    <li>
        Builds for Red Hat OpenShift
    </li>
</ul>
<h3>
    Step 1: Create the BuildConfig
</h3>
<p>
    Let's look at an example BuildConfig (<code>ruby_docker_git_buildconfig.yaml</code>):
</p>
<ul>
    <li>
        <code>spec.source</code> uses the <code>Git</code> type and defines a GitHub URI and branch. It also defines context directory, inline Dockerfile, secrets, and <code>ConfigMap</code> resources available in the builder pod.
    </li>
    <li>
        <code>spec.strategy</code> uses the <code>Docker</code> type and defines a <code>from</code> image that overrides the builder image in the project's Dockerfile. It also defines a pull secret to pull images from a private registry, flags (<code>noCache</code>, <code>forcePull</code>, <code>imageOptimizationPolicy</code>), volumes, environment variables, and build arguments.
    </li>
</ul>
<rh-alert state="info">
<h3 slot="header">
    Note
</h3>
<span class="rhalert-content">
<p>
    The <code>git.uri</code> field should point to the Git repository containing your application source code. This example uses <code>https://github.com/psrvere/ruby-hello-world</code> as a sample for demonstration purposes.
</p>
<p>
    &nbsp;
</p>
<p>
    The <code>from</code> field refers to a private registry image, <code>quay.io/prathore/ruby-27:latest</code>, which requires a <code>pullSecret</code> for authentication. When using your own BuildConfig, replace this with your own image and secret, or use a public image and remove the <code>pullSecret</code> field.
</p>
</span></rh-alert><pre><code class="language-plaintext">apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: ruby-docker-git
  namespace: default
spec:
  source:
    type: Git
    git:
      ref: interim
      uri: https://github.com/psrvere/ruby-hello-world
    contextDir: .
    dockerfile: |
      FROM ruby:2.7
      WORKDIR /app
      COPY . .
      RUN bundle install
      EXPOSE 4567
      CMD ["ruby", "app.rb"]
    secrets:
      - secret:
          name: database-credentials
        destinationDir: config
    configMaps:
      - configMap:
          name: app-config
        destinationDir: config
  strategy:
    type: Docker
    dockerStrategy:
      from:
        kind: DockerImage
        name: quay.io/prathore/ruby-27:latest
      pullSecret:
        name: registry-creds
      noCache: true
      env:
        - name: RACK_ENV
          value: production
      forcePull: true
      dockerfilePath: ./dockerfilelocation/Dockerfile
      buildArgs:
        - name: BUILD_VERSION
          value: 1.0.0
      imageOptimizationPolicy: SkipLayers
      volumes:
        - name: bundler-config
          source:
            type: Secret
            secret:
              secretName: bundler-secret
          mounts:
            - destinationPath: /workspace/Gemfile.lock</code></pre>
<h3>
    Step 2: Validate the BuildConfig
</h3>
<p>
    Make sure the BuildConfig is valid and runs correctly. Ensure secrets and <code>ConfigMap</code> resources are available in the cluster.
</p>
<pre><code class="language-plaintext">oc create imagestream ruby-docker-git
oc apply -f ruby_docker_git_buildconfig.yaml
oc start-build ruby-docker-git
oc get build</code></pre>
<h3>
    Step 3: Download Crane CLI
</h3>
<p>
    Download the latest <code>crane</code> CLI tool by running the following command:
</p>
<pre><code class="language-plaintext">curl -fsSL https://raw.githubusercontent.com/psrvere/download-crane/main/download-crane.sh | bash</code></pre>
<p>
This script automatically detects your platform and downloads the appropriate Crane binary.
</p>
<p>
Alternatively, you can manually download the binary for your platform from the <a href="https://github.com/migtools/crane/releases/">Crane Releases</a> page.
</p>
<h3>
Step 4: Run the migration
</h3>
<p>
Run the migration with the following command:
</p>
<pre><code class="language-plaintext">crane convert -r BuildConfigs -n default</code></pre>
<p>
Flags:
</p>
<ul>
    <li>
<code>-r BuildConfigs</code>: Required for BuildConfig migration
    </li>
    <li>
<code>-n default</code>: Specifies the namespace (mandatory)
    </li>
</ul>
<p>
The Crane CLI tool finds all BuildConfig resources in the namespace and migrates them to the Builds for Red Hat OpenShift format.
</p>
<p>
Output directories:
</p>
<ul>
    <li>
<code>./convert/buildconfigs/&lt;namespace&gt;/</code>: All extracted BuildConfig resources.
    </li>
    <li>
<code>./convert/builds/&lt;namespace&gt;/</code>: All migrated Build resources and supporting files.
    </li>
</ul>
<p>
You will see detailed logs for each BuildConfig. Here's an example output:
</p>
<pre><code class="language-plaintext">INFO Converting BuildConfigs in namespace: default 
INFO Found 1 BuildConfig to convert              
INFO -------------------------------------------------------- 
INFO Processing BuildConfig: ruby-docker-git at index 0 
INFO -------------------------------------------------------- 
INFO Docker strategy detected                     
WARN From Field in BuildConfig's Docker strategy is not yet supported in built-in Buildah ClusterBuildStrategy in Shipwright. RFE: https://issues.redhat.com/browse/BUILD-1746 
WARN NoCache flag is not yet supported in the built-in Buildah ClusterBuildStrategy in Shipwright. RFE: https://issues.redhat.com/browse/BUILD-1578 
INFO Processing Environment Variables             
WARN ForcePull flag is not yet supported in the built-in Buildah ClusterBuildStrategy in Shipwright. RFE: https://issues.redhat.com/browse/BUILD-1580 
INFO Processing Dockerfile path                   
INFO Processing Build Args                        
WARN ImageOptimizationPolicy (--squash) flag is not yet supported in the built-in Buildah ClusterBuildStrategy in Shipwright. RFE: https://issues.redhat.com/browse/BUILD-1581 
WARN Unlike BuildConfig, Volumes have to be supported in the Buildah Strategy first in Shipwright. Please raise your requirements here: https://issues.redhat.com/browse/BUILD-1747 
ERRO Inline Dockerfile is not supported in buildah strategy. Consider moving it to a separate file. 
INFO Processing Git Source                        
INFO Processing Git CloneSecret                   
WARN ConfigMaps are not yet supported in Shipwright build environment. RFE: https://issues.redhat.com/browse/BUILD-1745 
WARN Secrets are not yet supported in Shipwright build environment. RFE: https://issues.redhat.com/browse/BUILD-1744 
WARN Push to Openshift ImageStreams is not yet supported in Shipwright. RFE: https://issues.redhat.com/browse/BUILD-1756</code></pre>
<p>
    Understanding the logs:
</p>
<ul>
    <li>
        <code>INFO</code>: Successfully migrated fields
    </li>
    <li>
        <code>WARN</code>: Feature not yet supported but on the roadmap (includes RFE links)
    </li>
    <li>
        <code>ERRO</code>: Feature not planned for support
    </li>
</ul>
<p>
    In the generated OpenShift Build file, the <code>Build</code> resource defines a <code>ClusterBuildStrategy</code> (Buildah), a Git source with URL and branch, environment variables, build arguments, a custom Dockerfile location, and an output registry:
</p>
<pre><code class="language-plaintext">apiVersion: shipwright.io/v1beta1
kind: Build
metadata:
  creationTimestamp: "2025-12-16T11:17:37Z"
  name: ruby-docker-git
  namespace: default
spec:
  env:
    - name: RACK_ENV
      value: production
  output:
    image: image-registry.openshift-image-registry.svc:5000/default/ruby-docker-git:latest
  paramValues:
    - name: dockerfile
      value: dockerfilelocation/Dockerfile
    - name: build-args
      values:
        - value: BUILD_VERSION=1.0.0
  source:
    git:
      revision: interim
      url: https://github.com/psrvere/ruby-hello-world
    type: Git
  strategy:
    kind: ClusterBuildStrategy
    name: buildah</code></pre>
<h3>
    Step 5: Run the generated build
</h3>
<p>
    Review and modify if needed. First, check if you need to modify the generated files. In our case, we might need to change the output image. Although ImageStreams have been migrated to a correct URL in the generated file, this feature is not fully supported yet (see warnings).
</p>
<p>
    You can change the output image to use any public registry.
</p>
<p>
    Create a <code>BuildRun</code> resource (<code>ruby_docker_buildrun.yaml</code>):
</p>
<pre><code class="language-plaintext">apiVersion: shipwright.io/v1beta1
kind: BuildRun
metadata:
  name: ruby-docker-buildrun
  namespace: default
spec:
  build:
    name: ruby-docker-git
  serviceAccount: ruby-docker-git</code></pre>
<p>
    Run the <code>BuildRun</code>:
</p>
<pre><code class="language-plaintext">oc apply -f ruby_docker_buildrun.yaml
oc get buildrun</code></pre>
<p>
    You can also view a <a href="https://www.youtube.com/watch?v=6Z7brDRwF8s">video demo</a>.
</p>
<h2>
    Current availability and support
</h2>
<p>
    This migration tool is currently available as an upstream developer preview in the <a href="https://github.com/migtools/crane">Crane project</a>.
</p>
<p>
    This feature is not yet included in official Red Hat product offerings. We encourage you to try the developer preview and share your feedback as we work toward broader availability.
</p>
<p>
    If you have questions or issues, <a href="https://github.com/migtools/crane/issues">open an issue</a> on the Crane GitHub repository.
</p>